# ğŸš€ HÆ°á»›ng dáº«n Setup Thanh toÃ¡n QR Code - BÆ°á»›c nhanh

## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€





## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€




## âœ… CÃ¡c file Ä‘Ã£ Ä‘Æ°á»£c táº¡o:

1. âœ… `app/api/payments/create-qr/route.js` - API táº¡o QR code
2. âœ… `app/api/payments/check-status/route.js` - API kiá»ƒm tra thanh toÃ¡n
3. âœ… `app/api/cron/check-payments/route.js` - Cron job tá»± Ä‘á»™ng
4. âœ… `scripts/check-payments.js` - Script cháº¡y cron job
5. âœ… `prisma/migrations/add_payment_qr_code.sql` - SQL migration
6. âœ… `app/checkout/page.jsx` - ÄÃ£ cáº­p nháº­t Ä‘á»ƒ hiá»ƒn thá»‹ QR
7. âœ… `app/globals.css` - ÄÃ£ thÃªm CSS cho QR section

## ğŸ“‹ CÃ¡c bÆ°á»›c cáº§n lÃ m:

### BÆ°á»›c 1: Cháº¡y Migration Database

**CÃ¡ch 1: Cháº¡y SQL trá»±c tiáº¿p (Khuyáº¿n nghá»‹)**

Má»Ÿ MySQL vÃ  cháº¡y file SQL:

```bash
# Windows (PowerShell)
mysql -u root -p cinehub < prisma/migrations/add_payment_qr_code.sql

# Hoáº·c má»Ÿ MySQL Workbench vÃ  cháº¡y file SQL
```

**CÃ¡ch 2: DÃ¹ng Prisma (náº¿u khÃ´ng cÃ³ lá»—i drift)**

```bash
npx prisma migrate dev --name add_payment_qr_code
```

### BÆ°á»›c 2: Cáº¥u hÃ¬nh Environment Variables

ThÃªm vÃ o file `.env`:

```env
# Payment - Bank Transfer
BANK_ACCOUNT=1234567890
BANK_NAME=NgÃ¢n hÃ ng TMCP Ã ChÃ¢u (ACB)
ACCOUNT_NAME=LMK CINEMA

# Cron Job (táº¡o secret key ngáº«u nhiÃªn)
CRON_SECRET=your-random-secret-key-here-12345
API_URL=http://localhost:3000
```

**Táº¡o CRON_SECRET:**
```bash
# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString()))

# Hoáº·c dÃ¹ng online generator: https://randomkeygen.com/
```

### BÆ°á»›c 3: Generate Prisma Client

```bash
npx prisma generate
```

### BÆ°á»›c 4: Test há»‡ thá»‘ng

1. **Khá»Ÿi Ä‘á»™ng server:**
```bash
npm run dev
```

2. **Test táº¡o QR code:**
   - VÃ o trang checkout
   - ThÃªm vÃ© vÃ o giá» hÃ ng
   - Chá»n "Chuyá»ƒn khoáº£n QR"
   - Click "Thanh toÃ¡n"
   - Kiá»ƒm tra QR code cÃ³ hiá»ƒn thá»‹ khÃ´ng

3. **Test cron job (thá»§ cÃ´ng):**
```bash
# Má»Ÿ terminal má»›i
curl -X GET "http://localhost:3000/api/cron/check-payments" -H "Authorization: Bearer your-cron-secret"
```

### BÆ°á»›c 5: Setup Cron Job (TÃ¹y chá»n)

**Option A: Vercel Cron (náº¿u deploy lÃªn Vercel)**

Táº¡o file `vercel.json`:
```json
{
  "crons": [
    {
      "path": "/api/cron/check-payments",
      "schedule": "*/5 * * * *"
    }
  ]
}
```

**Option B: Local Cron (Windows Task Scheduler)**

1. Má»Ÿ Task Scheduler
2. Táº¡o task má»›i
3. Trigger: Má»—i 5 phÃºt
4. Action: Cháº¡y `node scripts/check-payments.js`

**Option C: GitHub Actions**

Táº¡o `.github/workflows/check-payments.yml`:
```yaml
name: Check Payments
on:
  schedule:
    - cron: '*/5 * * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check
        run: |
          curl -X GET "${{ secrets.API_URL }}/api/cron/check-payments" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
```

## ğŸ§ª Kiá»ƒm tra hoáº¡t Ä‘á»™ng

### 1. Táº¡o booking vÃ  QR code:
- VÃ o `/checkout`
- Chá»n "Chuyá»ƒn khoáº£n QR"
- Click thanh toÃ¡n
- âœ… QR code hiá»ƒn thá»‹
- âœ… ThÃ´ng tin ngÃ¢n hÃ ng hiá»ƒn thá»‹

### 2. Kiá»ƒm tra database:
```sql
SELECT * FROM payments ORDER BY created_at DESC LIMIT 5;
SELECT * FROM bookings WHERE payment_method = 'bank_transfer' ORDER BY created_at DESC LIMIT 5;
```

### 3. Test cron job:
```bash
# Gá»i API thá»§ cÃ´ng
curl -X GET "http://localhost:3000/api/cron/check-payments" \
  -H "Authorization: Bearer your-cron-secret"
```

## âš ï¸ LÆ°u Ã½ quan trá»ng

1. **TÃ­ch há»£p API ngÃ¢n hÃ ng thá»±c táº¿:**
   - Hiá»‡n táº¡i hÃ m `checkBankPayment` chá»‰ mÃ´ phá»ng
   - Cáº§n tÃ­ch há»£p vá»›i VietQR API hoáº·c API ngÃ¢n hÃ ng thá»±c táº¿
   - Xem file `app/api/cron/check-payments/route.js` Ä‘á»ƒ cáº­p nháº­t

2. **Báº£o máº­t:**
   - KhÃ´ng commit file `.env` lÃªn Git
   - Sá»­ dá»¥ng secret key máº¡nh cho `CRON_SECRET`
   - Báº£o vá»‡ API endpoints

3. **Thá»i gian háº¿t háº¡n:**
   - QR code máº·c Ä‘á»‹nh háº¿t háº¡n sau 15 phÃºt
   - CÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `app/api/payments/create-qr/route.js`

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

Xem file `docs/PAYMENT_SETUP.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- TÃ­ch há»£p API ngÃ¢n hÃ ng
- Troubleshooting
- Cáº¥u hÃ¬nh nÃ¢ng cao

## ğŸ†˜ Náº¿u gáº·p lá»—i

1. **Lá»—i migration:**
   - Kiá»ƒm tra MySQL Ä‘ang cháº¡y
   - Kiá»ƒm tra quyá»n user database
   - Cháº¡y tá»«ng cÃ¢u lá»‡nh SQL má»™t

2. **QR code khÃ´ng hiá»ƒn thá»‹:**
   - Kiá»ƒm tra package `qrcode` Ä‘Ã£ cÃ i: `npm list qrcode`
   - Kiá»ƒm tra console browser Ä‘á»ƒ xem lá»—i
   - Kiá»ƒm tra API `/api/payments/create-qr` cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng

3. **Cron job khÃ´ng cháº¡y:**
   - Kiá»ƒm tra `CRON_SECRET` Ä‘Ã£ Ä‘Ãºng chÆ°a
   - Kiá»ƒm tra API endpoint cÃ³ thá»ƒ truy cáº­p
   - Kiá»ƒm tra logs

---

**Báº¯t Ä‘áº§u tá»« BÆ°á»›c 1 nhÃ©!** ğŸš€














